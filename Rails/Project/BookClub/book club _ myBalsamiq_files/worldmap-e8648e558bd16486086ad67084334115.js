(function(){"use strict";function n(){var e=$(".worldmap-container"),t=e.find("canvas"),n=t.width()/100,r=t.height()/100;e.find(".worldmap-marker").each(function(){var e=$(this).data("person");$(this).css({left:n*e.x-$(this).width()/2,top:r*e.y-$(this).height()-5})})}function r(){worldmap.drawing.draw(new Date,e,t,$(".worldmap-output")[0]);n()}var e=new Image;var t=new Image;e.src="/static/worldmap-day.jpg";t.src="/static/worldmap-night.jpg";window.worldmap={updateMarkers:n,init:function(e){var t=$(".worldmap-container"),i=t.parent();$(".worldmap-container").click(function(){t.toggleClass("worldmap-fullscreen");if(t.is(".worldmap-fullscreen")){t.appendTo(document.body)}else{t.appendTo(i)}n()}).disableSelection();if(e.draggable){$(".worldmap-marker").addClass("worldmap-marker-draggable").draggable({containment:"parent",helper:"original",start:function(e,t){$(this).tooltip("disable")},stop:function(t,n){$(this).tooltip("enable");var r=$(this).parent().find("canvas"),i=r.width()/100,s=r.height()/100;var o=$(this).data("person");o.x=(n.position.left+$(this).width()/2)/i;o.y=(n.position.top+$(this).height()+5)/s;e.dragged(o)}})}r();setInterval(function(){r();e.redraw&&e.redraw()},1e3*60)}}})();worldmap.astronomy={degToRadians:function(e){return e*Math.PI/180},radiansToDegs:function(e){return e*180/Math.PI},springEquinox:{2007:{day:21,h:0,m:7},2008:{day:20,h:5,m:48},2009:{day:20,h:11,m:44},2010:{day:20,h:17,m:32},2011:{day:20,h:23,m:21},2012:{day:20,h:5,m:14},2013:{day:20,h:11,m:2},2014:{day:20,h:16,m:57},2015:{day:20,h:22,m:45},2016:{day:20,h:4,m:30},2017:{day:20,h:10,m:28},2018:{day:20,h:16,m:15},2019:{day:20,h:21,m:58},2020:{day:20,h:3,m:49}},fallEquinox:{2007:{day:23,h:9,m:51},2008:{day:22,h:15,m:44},2009:{day:22,h:21,m:18},2010:{day:23,h:3,m:9},2011:{day:23,h:9,m:4},2012:{day:22,h:14,m:49},2013:{day:22,h:20,m:44},2014:{day:23,h:2,m:29},2015:{day:23,h:8,m:20},2016:{day:22,h:14,m:21},2017:{day:22,h:20,m:2},2018:{day:23,h:1,m:54},2019:{day:23,h:7,m:50},2020:{day:22,h:13,m:30}},sunriseTime:function(e,t,n){return this.time(e,t,n,"sunrise")},sunsetTime:function(e,t,n){return this.time(e,t,n,"sunset")},time:function(e,t,n,r){var i=e/15;var s=r=="sunrise"?6:18;var o=(s-i)/24+n;var u=.9856*o-3.289;var a=u+1.916*Math.sin(this.degToRadians(u))+.02*Math.sin(this.degToRadians(2*u))+282.634;if(a<0){a+=360}else if(a>=360){a-=360}var f=this.radiansToDegs(Math.atan(.91764*Math.tan(this.degToRadians(a))));var l=Math.floor(a/90)*90;var c=Math.floor(f/90)*90;f+=l-c;f/=15;var h=.39782*Math.sin(this.degToRadians(a));var p=Math.cos(Math.asin(h));var d=(-.01454-h*Math.sin(this.degToRadians(t)))/(p*Math.cos(this.degToRadians(t)));if(d>1||d<-1){return 0}var v;if(r=="sunrise"){v=360-this.radiansToDegs(Math.acos(d))}else{v=this.radiansToDegs(Math.acos(d))}v/=15;var m=v+f-.06571*o-6.622;var g=m-i;if(g<0){g+=24}else if(g>=24){g-=24}return g},dayOfYear:function(e,t,n){var r=Math.floor(275*t/9);var i=Math.floor((t+9)/12);var s=1+Math.floor((e-4*Math.floor(e/4)+2)/3);return r-i*s+n-30}};(function(e){function t(e,t,n,r,i){if(!document.createElement("canvas").getContext)return e;var s=document.createElement("canvas"),o=s.getContext("2d"),u=document.createElement("canvas"),a=u.getContext("2d"),f=null,l=null,c=null;s.width=n;s.height=r*2;u.width=n;u.height=r;o.drawImage(e,0,0);o.drawImage(t,0,r);f=o.getImageData(0,0,n,r);l=f.data;c=o.getImageData(0,r,n,r).data;for(var h=3,p=l.length;h<p;h=h+4){l[h]=c[h]}if(i){a.clearRect(0,0,n,r);a.putImageData(f,0,0);return u.toDataURL()}else{return f}}function i(e,t,i,o,u,a){if(isNaN(a)||a<1)return;a|=0;var f=e.getContext("2d");var l=f.getImageData(t,i,o,u);var c=l.data;var h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H;var B=a+a+1;var j=o<<2;var F=o-1;var I=u-1;var q=a+1;var R=q*(q+1)/2;var U=new s;var z=U;for(d=1;d<B;d++){z=z.next=new s;if(d==q)var W=z}z.next=U;var X=null;var V=null;y=g=0;var $=n[a];var J=r[a];for(p=0;p<u;p++){k=L=A=O=b=w=E=S=0;x=q*(M=c[g]);T=q*(_=c[g+1]);N=q*(D=c[g+2]);C=q*(P=c[g+3]);b+=R*M;w+=R*_;E+=R*D;S+=R*P;z=U;for(d=0;d<q;d++){z.r=M;z.g=_;z.b=D;z.a=P;z=z.next}for(d=1;d<q;d++){v=g+((F<d?F:d)<<2);b+=(z.r=M=c[v])*(H=q-d);w+=(z.g=_=c[v+1])*H;E+=(z.b=D=c[v+2])*H;S+=(z.a=P=c[v+3])*H;k+=M;L+=_;A+=D;O+=P;z=z.next}X=U;V=W;for(h=0;h<o;h++){c[g+3]=P=S*$>>J;if(P!=0){P=255/P;c[g]=(b*$>>J)*P;c[g+1]=(w*$>>J)*P;c[g+2]=(E*$>>J)*P}else{c[g]=c[g+1]=c[g+2]=0}b-=x;w-=T;E-=N;S-=C;x-=X.r;T-=X.g;N-=X.b;C-=X.a;v=y+((v=h+a+1)<F?v:F)<<2;k+=X.r=c[v];L+=X.g=c[v+1];A+=X.b=c[v+2];O+=X.a=c[v+3];b+=k;w+=L;E+=A;S+=O;X=X.next;x+=M=V.r;T+=_=V.g;N+=D=V.b;C+=P=V.a;k-=M;L-=_;A-=D;O-=P;V=V.next;g+=4}y+=o}for(h=0;h<o;h++){L=A=O=k=w=E=S=b=0;g=h<<2;x=q*(M=c[g]);T=q*(_=c[g+1]);N=q*(D=c[g+2]);C=q*(P=c[g+3]);b+=R*M;w+=R*_;E+=R*D;S+=R*P;z=U;for(d=0;d<q;d++){z.r=M;z.g=_;z.b=D;z.a=P;z=z.next}m=o;for(d=1;d<=a;d++){g=m+h<<2;b+=(z.r=M=c[g])*(H=q-d);w+=(z.g=_=c[g+1])*H;E+=(z.b=D=c[g+2])*H;S+=(z.a=P=c[g+3])*H;k+=M;L+=_;A+=D;O+=P;z=z.next;if(d<I){m+=o}}g=h;X=U;V=W;for(p=0;p<u;p++){v=g<<2;c[v+3]=P=S*$>>J;if(P>0){P=255/P;c[v]=(b*$>>J)*P;c[v+1]=(w*$>>J)*P;c[v+2]=(E*$>>J)*P}else{c[v]=c[v+1]=c[v+2]=0}b-=x;w-=T;E-=N;S-=C;x-=X.r;T-=X.g;N-=X.b;C-=X.a;v=h+((v=p+q)<I?v:I)*o<<2;b+=k+=X.r=c[v];w+=L+=X.g=c[v+1];E+=A+=X.b=c[v+2];S+=O+=X.a=c[v+3];X=X.next;x+=M=V.r;T+=_=V.g;N+=D=V.b;C+=P=V.a;k-=M;L-=_;A-=D;O-=P;V=V.next;g+=o}}f.putImageData(l,t,i)}function s(){this.r=0;this.g=0;this.b=0;this.a=0;this.next=null}e.drawing={createCanvas:function(e,t){var n=document.createElement("canvas");n.width=e;n.height=t;return n},draw:function(e,n,r,s){var o=800,u=400;var a=this.createCanvas(o,u);maskCtx=a.getContext("2d");this.drawMask(maskCtx,e);i(a,0,0,o,u,30);var f=maskCtx.getImageData(0,0,o,u);var l=t(n,a,o,u);var c=this.createCanvas(o,u);c.getContext("2d").putImageData(l,0,0);var h=s.getContext("2d");h.clearRect(0,0,h.canvas.width,h.canvas.height);h.drawImage(r,0,0,o,u);h.drawImage(c,0,0,o,u)},drawMask:function(t,n){var r=n.getUTCFullYear();var i=e.astronomy.springEquinox[r];var s=e.astronomy.dayOfYear(r,3,i.day)+(i.h+i.m/60)/24;var o=e.astronomy.fallEquinox[r];var u=e.astronomy.dayOfYear(r,9,o.day)+(o.h+o.m/60)/24;var a=n.getUTCHours()+n.getUTCMinutes()/60+n.getUTCSeconds()/3600;var f=e.astronomy.dayOfYear(r,n.getUTCMonth()+1,n.getUTCDate());var l=f+a/24;var c=l>s&&l<u;var h=c?0:180;var p=10;var d=t.canvas.width/360,v=t.canvas.height/180;for(var m=-180;m<=180;m=m+p){for(var g=90;g>=-90;g=g-p){var y=e.astronomy.sunriseTime(m,g,f);var b=e.astronomy.sunsetTime(m,g,f);var w=false;if(b===0||y===0){b=0;y=0}if(b===0&&y===0){if(g<0){if(!c){w=true}}else{if(c){w=true}}}else if(b<y){if(a>y&&a<b+24||a+24>y&&a+24<b+24){w=true}}else{if(a>y&&a<b){w=true}}if(false&&m==130){console.log("latitude: "+g+" - sunriseTime :"+y+" - sunsetTime: "+b+" - currentUTC:"+a+" - "+(w?" DAY":"NIGHT"))}if(w){t.fillRect((180+m)*d,(90+ -g)*v,d*p,v*p)}}}}};var n=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];var r=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24]})(worldmap);window.worldmap||(window.worldmap={});worldmap.time=function(e){function u(e){var t=/pm/.test(e);return parseInt(e)+(t?12:0)}var t=1e3*60*60;var n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var r=new Date;var i=r.getTime()+r.getTimezoneOffset()*t/60;var s=new Date;s.setTime(i+t*e.offset);var o=s.getHours();var a=u(e.workingBegin);var f=u(e.workingEnd);var l="offline";if(o>=a&&o<f){l="online"}else if(o>=f&&o<f+1){l="away"}else if(o>=a-1&&o<a){l="away"}var c=n[s.getDay()]+", "+s.getHours()+":";if(s.getMinutes()<10){c+="0"+s.getMinutes()}else{c+=s.getMinutes()}return{available:l,time:c}}